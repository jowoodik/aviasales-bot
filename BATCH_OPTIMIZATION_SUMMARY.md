# –†–µ–∑—é–º–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤

**–î–∞—Ç–∞:** 2026-02-09

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è batch-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `services/AviasalesPricer.js` - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `getPricesFromUrlsWithIndividualFilters()`
- `services/UnifiedMonitor.js` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `prepareBatchItem()` –∏ `processBatchResults()`
- `scheduler.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `checkRoutesBySubscriptionBatch()`, –∏–∑–º–µ–Ω–µ–Ω–∞ `checkRoutesBySubscription()`

#### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- ‚úÖ –ö–∞–∂–¥—ã–π –º–∞—Ä—à—Ä—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–æ –°–í–û–ò–ú–ò —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (airline, baggage, max_stops, max_layover_hours)
- ‚úÖ –í—Å–µ 10 —Å–ª–æ—Ç–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤—Å—è –ª–æ–≥–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å, NO_RESULTS)
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `checkUserRoutes()` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/check`

### 2. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã:
- `docs/batch-optimization.md` - –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è, –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `docs/batch-optimization-testing.md` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- `BATCH_OPTIMIZATION_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### 3. –¢–µ—Å—Ç—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –≤ –ø–∞–ø–∫–µ `test/batch-optimization/`:

#### Unit-—Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ, –±–µ–∑ API –∑–∞–ø—Ä–æ—Å–æ–≤):
1. **01-unit-prepareBatchItem.test.js** ‚úÖ –ü–†–û–ô–î–ï–ù
   - –û–±—ã—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç (1 –∫–æ–º–±–∏–Ω–∞—Ü–∏—è)
   - –ì–∏–±–∫–∏–π –º–∞—Ä—à—Ä—É—Ç (20 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π)
   - –ú–∞—Ä—à—Ä—É—Ç —Å null –¥–∞—Ç–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤

2. **02-unit-processBatchResults.test.js** ‚úÖ –ü–†–û–ô–î–ï–ù
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü (route_results, route_check_stats, combination_check_results, price_analytics)

#### Integration-—Ç–µ—Å—Ç—ã (—Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API –∑–∞–ø—Ä–æ—Å–∞–º–∏):
3. **03-integration-batch30.test.js** - —Ç–µ—Å—Ç batch –∏–∑ 30 –º–∞—Ä—à—Ä—É—Ç–æ–≤
   - –°–æ–∑–¥–∞–µ—Ç 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è √ó 10 –º–∞—Ä—à—Ä—É—Ç–æ–≤
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—É—é batch-–ø—Ä–æ–≤–µ—Ä–∫—É
   - –ò–∑–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

4. **04-integration-filters.test.js** - —Ç–µ—Å—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –°–æ–∑–¥–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –∫–∞–∂–¥—ã–π –º–∞—Ä—à—Ä—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–æ —Å–≤–æ–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ü–µ–Ω—ã

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `test/batch-optimization/README.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É —Ç–µ—Å—Ç–æ–≤
- `test/batch-optimization/run-unit-tests.sh` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ unit-—Ç–µ—Å—Ç–æ–≤

### 4. NPM —Å–∫—Ä–∏–ø—Ç—ã

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤ `package.json`:
```json
"test:batch:unit": "–∑–∞–ø—É—Å–∫ unit-—Ç–µ—Å—Ç–æ–≤",
"test:batch:integration": "–∑–∞–ø—É—Å–∫ integration-—Ç–µ—Å—Ç–æ–≤",
"test:batch": "–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤"
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π √ó 1 –º–∞—Ä—à—Ä—É—Ç**
- –†–∞–Ω—å—à–µ: 100 —Å–µ–∫—É–Ω–¥
- –°–µ–π—á–∞—Å: 10 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–∏—Ä–æ—Å—Ç: 10x**

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: 30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π √ó 1 –º–∞—Ä—à—Ä—É—Ç**
- –†–∞–Ω—å—à–µ: 300 —Å–µ–∫—É–Ω–¥
- –°–µ–π—á–∞—Å: 30 —Å–µ–∫—É–Ω–¥
- **–ü—Ä–∏—Ä–æ—Å—Ç: 10x**

**–¢–∏–ø–∏—á–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç: 2-10x –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤**

## üß™ –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [x] Unit-—Ç–µ—Å—Ç—ã: **–ü–†–û–ô–î–ï–ù–´**
- [ ] Integration-—Ç–µ—Å—Ç—ã: **–ù–ï –ó–ê–ü–£–°–ö–ê–õ–ò–°–¨** (—Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã)
- [ ] Staging —Ç–µ—Å—Ç—ã: **–ù–ï –ü–†–û–í–û–î–ò–õ–ò–°–¨**
- [ ] Production rollout: **–ù–ï –ù–ê–ß–ê–¢**

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ó–∞–ø—É—Å—Ç–∏—Ç—å integration-—Ç–µ—Å—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ - —Ä–µ–∞–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã!):

```bash
# Unit-—Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ)
npm run test:batch:unit

# Integration-—Ç–µ—Å—Ç—ã (–º–µ–¥–ª–µ–Ω–Ω–æ, ~1-2 –º–∏–Ω—É—Ç—ã)
npm run test:batch:integration
```

### 2. Staging

1. –î–µ–ø–ª–æ–π –Ω–∞ staging —Å–µ—Ä–≤–µ—Ä
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å integration-—Ç–µ—Å—Ç—ã –Ω–∞ staging
3. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π:
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–¥–æ–ª–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å—Å—è –≤ 2-10x)
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–Ω–µ –¥–æ–ª–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)
   - –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö (–Ω–µ –¥–æ–ª–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å—Å—è)

### 3. Production Rollout (–ø–æ—ç—Ç–∞–ø–Ω—ã–π)

**–î–µ–Ω—å 1-2: Admin –ø–æ–¥–ø–∏—Å–∫–∞**
- –í–∫–ª—é—á–∏—Ç—å batch –¥–ª—è admin (–º–µ–Ω—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥—ã–π —á–∞—Å
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

**–î–µ–Ω—å 3-4: Plus –ø–æ–¥–ø–∏—Å–∫–∞**
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã admin - –≤–∫–ª—é—á–∏—Ç—å –¥–ª—è plus
- –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–î–µ–Ω—å 5-7: Free –ø–æ–¥–ø–∏—Å–∫–∞**
- –ü–æ–ª–Ω—ã–π rollout –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫
- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Production

–°–ª–µ–¥–∏—Ç—å –∑–∞:
- ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫
- üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- üîî –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚ùå –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
- üíæ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

### 5. Rollback –ø–ª–∞–Ω (–Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º)

```bash
# –ë—ã—Å—Ç—Ä—ã–π rollback
git revert HEAD
git push
pm2 restart aviasales-bot
pm2 restart scheduler

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
cp data/bot.db.backup-20260209 data/bot.db
```

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è batch-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏](docs/batch-optimization.md)
- [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é](docs/batch-optimization-testing.md)
- [README —Ç–µ—Å—Ç–æ–≤](test/batch-optimization/README.md)

## üìà –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- [x] –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ
- [x] Unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] Integration-—Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] Staging —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω—ã
- [ ] Production rollout –∑–∞–≤–µ—Ä—à–µ–Ω
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (future)

1. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –±–∞—Ç—á–∏–Ω–≥** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏
2. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å CRITICAL –º–∞—Ä—à—Ä—É—Ç—ã –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –¥–∞—Ç
4. **–ú–µ—Ç—Ä–∏–∫–∏** - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞—Ç—á–µ–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
5. **Retry –ª–æ–≥–∏–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –¥–ª—è failed –ø—Ä–æ–≤–µ—Ä–æ–∫

## ‚úçÔ∏è –ê–≤—Ç–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ Claude Sonnet 4.5 (2026-02-09)

---

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é:** ‚úÖ (–ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è integration-—Ç–µ—Å—Ç–æ–≤ –∏ staging)
