# ะกะธััะตะผะฐ ัะฒะตะดะพะผะปะตะฝะธะน

## ะะฑะทะพั

ะกะธััะตะผะฐ ัะฒะตะดะพะผะปะตะฝะธะน ะฟะพัััะพะตะฝะฐ ะฝะฐ ัััั ะฝะตะทะฐะฒะธัะธะผัั ัะฒะพะนััะฒะฐั:

1. **ะัะธัะธัะฝะพััั** โ ะพะฟัะตะดะตะปัะตั ะฒะฐะถะฝะพััั ะฝะฐัะพะดะบะธ
2. **ะะตัะธะพะดะธัะฝะพััั** โ ะบะพะฝััะพะปะธััะตั ัะฐััะพัั ะพัะฟัะฐะฒะบะธ
3. **ะะฝะตัะฝะธะน ะฒะธะด** โ ัะพัะผะฐั ัะพะพะฑัะตะฝะธั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั

---

## ๐ฆ ะฃัะพะฒะฝะธ ะฟัะธะพัะธัะตัะพะฒ

### ๐จ CRITICAL โ ัะตะฝะฐ ะฝะธะถะต ะฑัะดะถะตัะฐ

**ะฃัะปะพะฒะธะต:**
```javascript
best_price < budget
```

**ะะตัะธะพะดะธัะฝะพััั:** URGENT โ ัะฐะท ะฒ 6 ัะฐัะพะฒ ะะะ ะฟัะธ ะฟะฐะดะตะฝะธะธ ัะตะฝั

**ะัะพะฒะตัะบะฐ ะพัะฟัะฐะฒะบะธ:**
1. ะะตั ะทะฐะฟะธัะตะน ะฒ notification_log โ โ ะพัะฟัะฐะฒะปัะตะผ
2. ะะพัะปะตะดะฝะตะต URGENT ัะฒะตะดะพะผะปะตะฝะธะต > 6ั โ โ ะพัะฟัะฐะฒะปัะตะผ
3. ะะพัะปะตะดะฝะตะต URGENT ัะฒะตะดะพะผะปะตะฝะธะต < 6ั:
   - ะัะปะธ `old_price > best_price` โ โ ะพัะฟัะฐะฒะปัะตะผ (ัะตะฝะฐ ัะฟะฐะปะฐ)
   - ะะฝะฐัะต โ โ ะฝะต ะพัะฟัะฐะฒะปัะตะผ

**ะะฒัะบ:** ะกะพ ะทะฒัะบะพะผ (ะตัะปะธ notifications_enabled=1 ะธ ะฒัะตะผั 08:00-23:00)

**ะคะพัะผะฐั:**
```
๐ฅ๐ฅ๐ฅ ะฆะตะฝะฐ ะฝะธะถะต ะฑัะดะถะตัะฐ

<b>ะะบะฐัะตัะธะฝะฑััะณ โ ะกัะฐะผะฑัะป</b>
๐ 13.03โ20.03 (7 ะดะฝะตะน)
๐ฅ 2 ะฒะทัะพัะปัั

๐ <b>14 900 โฝ</b> ะทะฐ ะฒัะตั

<b>๐ฐ ะญะบะพะฝะพะผะธั 7 400 โฝ (-33%)</b>

๐ฏ ะะฐั ะฑัะดะถะตั: 18 000 โฝ โ
๐ ะะฑััะฝะฐั ัะตะฝะฐ: 22 300 โฝ

โ๏ธ Turkish Airlines โข ะััะผะพะน โข ๐งณ

โก๏ธ ะฆะตะฝะฐ ะผะพะถะตั ะฒััะฐััะธ ะฒ ะฑะปะธะถะฐะนัะธะต ัะฐัั

[๐ซ ะะฃะะะขะฌ ะกะะะงะะก]
```

---

### ๐ฅ HIGH โ ัะฐะผะฐั ะฝะธะทะบะฐั ัะตะฝะฐ

**ะฃัะปะพะฒะธะต:**
```javascript
best_price < bestHistoricalPrice && !(best_price < budget)
```

**ะะตัะธะพะดะธัะฝะพััั:** DAILY โ ัะฐะท ะฒ 12 ัะฐัะพะฒ

**ะัะพะฒะตัะบะฐ ะพัะฟัะฐะฒะบะธ:**
1. ะะตั ะทะฐะฟะธัะตะน ะฒ notification_log โ โ ะพัะฟัะฐะฒะปัะตะผ
2. ะะพัะปะตะดะฝะตะต ัะฒะตะดะพะผะปะตะฝะธะต (ะปัะฑะพะณะพ ัะธะฟะฐ) > 12ั โ โ ะพัะฟัะฐะฒะปัะตะผ
3. ะะพัะปะตะดะฝะตะต ัะฒะตะดะพะผะปะตะฝะธะต < 12ั โ โ ะฝะต ะพัะฟัะฐะฒะปัะตะผ

**ะะฒัะบ:** ะกะพ ะทะฒัะบะพะผ (ะตัะปะธ notifications_enabled=1 ะธ ะฒัะตะผั 08:00-23:00)

**ะคะพัะผะฐั:**
```
๐ ะกะฐะผะฐั ะฝะธะทะบะฐั ัะตะฝะฐ โข 16:52

<b>ะะพัะบะฒะฐ โ ะะตะฝะฟะฐัะฐั (ะะฐะปะธ)</b>
๐ 4.03โ1.04 (28 ะดะฝะตะน)
๐ฅ 4+1 โข 1 ะฟะตัะตัะฐะดะบะฐ โข ๐งณ

๐ฐ <b>386 646 โฝ</b> ะทะฐ ะฒัะตั

ะะฐั ะฑัะดะถะตั: 350 000 โฝ (+10%)
ะกัะตะดะฝัั ัะตะฝะฐ: 437 551 โฝ (-12%)

โ๏ธ Emirates

๐ก ะัะพะดะพะปะถะฐั ะธัะบะฐัั ะฒะฐัะธะฐะฝัั ะฒ ะฑัะดะถะตัะต

[๐ซ ะะพัะผะพััะตัั ะฑะธะปะตั]
```

---

### ๐ LOW โ ะฟัะพะดะพะปะถะฐะตะผ ะฟะพะธัะบ

**ะฃัะปะพะฒะธะต:**
```javascript
// ะัั ะพััะฐะปัะฝะพะต
```

**ะะตัะธะพะดะธัะฝะพััั:** DAILY โ ัะฐะท ะฒ 24 ัะฐัะฐ

**ะัะพะฒะตัะบะฐ ะพัะฟัะฐะฒะบะธ:**
1. ะะตั ะทะฐะฟะธัะตะน ะฒ notification_log โ โ ะพัะฟัะฐะฒะปัะตะผ
2. ะะพัะปะตะดะฝะตะต ัะฒะตะดะพะผะปะตะฝะธะต (ะปัะฑะพะณะพ ัะธะฟะฐ) > 24ั โ โ ะพัะฟัะฐะฒะปัะตะผ
3. ะะพัะปะตะดะฝะตะต ัะฒะตะดะพะผะปะตะฝะธะต < 24ั โ โ ะฝะต ะพัะฟัะฐะฒะปัะตะผ

**ะะฒัะบ:** โ ะัะตะณะดะฐ ะะะ ะทะฒัะบะฐ

**ะคะพัะผะฐั:**
```
๐ ะัะพะดะพะปะถะฐะตะผ ะฟะพะธัะบ โข 16:52

<b>ะะบะฐัะตัะธะฝะฑััะณ โ ะะพัะบะฒะฐ</b>
๐ 26.02โ28.03
๐ฅ 4+1

ะฆะตะฝะฐ: 80 736 โฝ
ะะฐั ะฑัะดะถะตั: 40 000 โฝ (ะฟัะตะฒััะตะฝะธะต ะฒ 2 ัะฐะทะฐ)

ะัะพะดะพะปะถะฐั ะผะพะฝะธัะพัะธะฝะณ ๐
```

---

### โ NO_RESULTS โ ัะตะฝั ะฝะต ะฝะฐะนะดะตะฝั

**ะฃัะปะพะฒะธะต:** ะะตั ัะตะทัะปััะฐัะพะฒ ะฟะพะธัะบะฐ

**ะะตัะธะพะดะธัะฝะพััั:** ะะฐะท ะฒ 48 ัะฐัะพะฒ

**ะัะพะฒะตัะบะฐ ะพัะฟัะฐะฒะบะธ:**
1. ะะตั ะทะฐะฟะธัะตะน ะฒ notification_log โ โ ะพัะฟัะฐะฒะปัะตะผ
2. ะะพัะปะตะดะฝะตะต ัะฒะตะดะพะผะปะตะฝะธะต > 48ั โ โ ะพัะฟัะฐะฒะปัะตะผ
3. ะะพัะปะตะดะฝะตะต ัะฒะตะดะพะผะปะตะฝะธะต < 48ั โ โ ะฝะต ะพัะฟัะฐะฒะปัะตะผ

**ะะฒัะบ:** โ ะัะตะณะดะฐ ะะะ ะทะฒัะบะฐ

**ะคะพัะผะฐั:**
```
๐ ะฆะตะฝั ะฝะต ะฝะฐะนะดะตะฝั โข 15:20

<b>ะะบะฐัะตัะธะฝะฑััะณ โ ะะฐะปัะดะธะฒั</b>
โ ะฆะตะฝั ะฝะต ะฝะฐะนะดะตะฝั
ะะฐั ะฑัะดะถะตั: 120 000 โฝ

ะกะตะนัะฐั ะฒัะฟะพะปะฝะตะฝะพ 45 ะฟัะพะฒะตัะพะบ. ะัะตะณะพ ะฟัะพะฒะตัะพะบ 2184

ะัะพะดะพะปะถะฐั ะผะพะฝะธัะพัะธะฝะณ ๐
```

---

## ๐ ะะฟัะตะดะตะปะตะฝะธะต ะทะฒัะบะฐ

### ะะปั LOW ะธ NO_RESULTS
```javascript
disable_notification = true; // ะัะตะณะดะฐ ะะะ ะทะฒัะบะฐ
```

### ะะปั CRITICAL ะธ HIGH
```javascript
let disable_notification = false;

// ะัะพะฒะตัะบะฐ 1: ะะฐัััะพะนะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั
if (user.notifications_enabled === 0) {
  disable_notification = true;
}

// ะัะพะฒะตัะบะฐ 2: ะะพัะฝะพะต ะฒัะตะผั (23:00 - 08:00)
const hour = new Date().getHours();
if (hour >= 23 || hour < 8) {
  disable_notification = true;
}
```

**ะัะพะณะพ:**
- CRITICAL/HIGH ัะพ ะทะฒัะบะพะผ โ ัะพะปัะบะพ ะตัะปะธ `notifications_enabled=1` ะ ะฒัะตะผั 08:00-23:00
- ะะพ ะฒัะตั ะพััะฐะปัะฝัั ัะปััะฐัั โ ะะะ ะทะฒัะบะฐ

---

## ๐ ะกะฒะพะดะฝะฐั ัะฐะฑะปะธัะฐ

| ะัะธะพัะธัะตั | ะฃัะปะพะฒะธะต | ะะตัะธะพะดะธัะฝะพััั | ะะฒัะบ | ะะฝะพะฟะบะฐ |
|-----------|---------|---------------|------|--------|
| ๐จ CRITICAL | ัะตะฝะฐ < ะฑัะดะถะตั | 6ั ะธะปะธ ะฟะฐะดะตะฝะธะต ัะตะฝั | ะะฐ* | ๐ซ ะะฃะะะขะฌ ะกะะะงะะก |
| ๐ฅ HIGH | ัะตะฝะฐ < historical min | **12ั** | ะะฐ* | ๐ซ ะะพัะผะพััะตัั ะฑะธะปะตั |
| ๐ LOW | ะฒัั ะพััะฐะปัะฝะพะต | 24ั | **ะะะข** | ะฝะตั |
| โ NO_RESULTS | ะฝะตั ัะตะทัะปััะฐัะพะฒ | 48ั | ะะะข | ะฝะตั |

**\* ะะฒัะบ:** ะขะพะปัะบะพ ะตัะปะธ `notifications_enabled=1` ะ ะฒัะตะผั 08:00-23:00

---

## ๐พ ะะฐะทะฐ ะดะฐะฝะฝัั

### ะขะฐะฑะปะธัะฐ notification_log

```sql
CREATE TABLE notification_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  chat_id INTEGER NOT NULL,
  route_id INTEGER,
  priority TEXT NOT NULL,        -- 'CRITICAL', 'HIGH', 'LOW', 'NO_RESULTS'
  price REAL,
  message_type TEXT NOT NULL,    -- 'URGENT', 'DAILY', 'NO_RESULTS'
  sent_at DATETIME DEFAULT (datetime('now')),
  disable_notification INTEGER DEFAULT 0
);
```

### ะัะธะผะตัั ะทะฐะฟะธัะตะน

```sql
-- CRITICAL ัะฒะตะดะพะผะปะตะฝะธะต ะดะฝัะผ ัะพ ะทะฒัะบะพะผ
(123456, 1, 'CRITICAL', 14900, 'URGENT', '2026-02-09 14:30:00', 0)

-- HIGH ัะฒะตะดะพะผะปะตะฝะธะต ะดะฝัะผ ัะพ ะทะฒัะบะพะผ (ัะฐะท ะฒ 12ั)
(123456, 2, 'HIGH', 386646, 'DAILY', '2026-02-09 10:15:00', 0)

-- HIGH ัะฒะตะดะพะผะปะตะฝะธะต ัะตัะตะท 12ั
(123456, 2, 'HIGH', 384000, 'DAILY', '2026-02-09 22:30:00', 0)

-- LOW ัะฒะตะดะพะผะปะตะฝะธะต (ะฒัะตะณะดะฐ ะฑะตะท ะทะฒัะบะฐ)
(123456, 3, 'LOW', 80736, 'DAILY', '2026-02-09 16:52:00', 1)

-- ะะตั ัะตะทัะปััะฐัะพะฒ
(123456, 4, 'NO_RESULTS', NULL, 'NO_RESULTS', '2026-02-09 15:20:00', 1)
```

---

## ๐ Workflow

### 1. ะัะพะฒะตัะบะฐ ะผะฐัััััะฐ
```
scheduler.js: checkUserRoutes(chatId)
  โ
UnifiedMonitor.checkSingleRoute(route)
  โ ะกะพััะฐะฝะตะฝะธะต ัะตะทัะปััะฐัะพะฒ ะฒ ะะ
```

### 2. ะะตั ัะตะทัะปััะฐัะพะฒ?
```
if (!bestResult) {
  โ NotificationService.processNoResults(chatId, routeId)
  โ ะตัะปะธ shouldSend: ะพัะฟัะฐะฒะธัั NO_RESULTS ัะฒะตะดะพะผะปะตะฝะธะต
  โ continue; // ะฟะตัะตัะพะด ะบ ัะปะตะดัััะตะผั ะผะฐัััััั
}
```

### 3. ะััั ัะตะทัะปััะฐัั
```
NotificationService.getRouteAnalytics(routeId)
  โ
NotificationService.classifyPriority({
  currentPrice,
  userBudget,
  historicalMin
})
  โ { priority: 'CRITICAL' | 'HIGH' | 'LOW', reasons }
```

### 4. ะะฐัััััะธะทะฐัะธั
```
NotificationService.processAndRouteNotification(...)
  โ
_canSendNotification(chatId, routeId, priority, currentPrice)
  โ { canSend: true/false, reason }
  โ
if (canSend) {
  โ ะพะฟัะตะดะตะปะธัั message_type (URGENT/DAILY)
  โ ะพะฟัะตะดะตะปะธัั disable_notification
  โ _logNotification()
  โ ะฒะตัะฝััั { action: 'sent' | 'sent_silent' }
}
```

### 5. ะัะฟัะฐะฒะบะฐ
```
if (action === 'sent' || action === 'sent_silent') {
  formatSingleRouteBlock(route, bestResult, analytics, checkStats, priority)
  โ
  _sendInstantAlert(chatId, routeId, block, priority, price, timezone, silent)
    โ ะดะพะฑะฐะฒะธัั ะทะฐะณะพะปะพะฒะพะบ ะฟะพ ะฟัะธะพัะธัะตัั
    โ ะดะพะฑะฐะฒะธัั ัััะตั ะฟะพ ะฟัะธะพัะธัะตัั
    โ ะดะพะฑะฐะฒะธัั inline-ะบะฝะพะฟะบั
    โ bot.sendMessage()
}
```

---

## ๐ฏ ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ

### โ ะงัะพ ะะกะขะฌ
- **ะฃะผะฝะฐั ะฟะตัะธะพะดะธัะฝะพััั:** CRITICAL ัะฐัะต, LOW ัะตะถะต
- **ะััะปะตะถะธะฒะฐะฝะธะต ะฟะฐะดะตะฝะธั ัะตะฝั:** CRITICAL ะพัะฟัะฐะฒะปัะตััั ะฟัะธ ะฟะฐะดะตะฝะธะธ ะดะฐะถะต < 6ั
- **ะะฐัะธัะฐ ะพั ัะฟะฐะผะฐ:** ัััะพะณะธะน ะบะพะฝััะพะปั ัะฐััะพัั ะดะปั ะบะฐะถะดะพะณะพ ัะธะฟะฐ
- **NO_RESULTS:** ัะฒะตะดะพะผะปะตะฝะธะต ะพ ะพััััััะฒะธะธ ัะตะฝ ัะฐะท ะฒ 48ั
- **Inline-ะบะฝะพะฟะบะธ:** ะฑัััััะน ะฟะตัะตัะพะด ะบ ะฟะพะบัะฟะบะต
- **ะะฐะทะฝัะต ัะพัะผะฐัั:** ะฟัะพะดะฐััะธะน ะดะปั CRITICAL, ะฝะตะนััะฐะปัะฝัะน ะดะปั HIGH, ะผะธะฝะธะผะฐะปัะฝัะน ะดะปั LOW

### โ ะงัะพ ะฃะะะะะะ
- โ ะะฐะนะดะถะตััั (daily_digest_queue ะฝะต ะธัะฟะพะปัะทัะตััั)
- โ ะะฐะทะปะธัะธั Free/Plus ะฒ ะปะพะณะธะบะต ัะฒะตะดะพะผะปะตะฝะธะน
- โ ะะธะผะธั 3 CRITICAL ะฒ ะดะตะฝั ะดะปั Free
- โ ะัะปะดะฐัะฝ 3ั ะดะปั HIGH ั Plus
- โ MEDIUM ะฟัะธะพัะธัะตั
- โ ะกะฒะพะดะฝัะต ะพััะตัั ะฒ scheduler (ะบะฐะถะดะพะต ัะฒะตะดะพะผะปะตะฝะธะต ะพัะดะตะปัะฝะพ)

### โ ะงัะพ ะะกะขะะะะะะ
- โ sendConsolidatedReport() ะดะปั ะบะพะผะฐะฝะดั /check
- โ ะขะฐะฑะปะธัะฐ daily_digest_queue ะฒ ะะ (ะดะปั ัะพะฒะผะตััะธะผะพััะธ)
- โ ะะฐัััะพะนะบะฐ notifications_enabled (ัะฟัะฐะฒะปะตะฝะธะต ะทะฒัะบะพะผ)
- โ ะะพัะฝะพะน ัะตะถะธะผ (ะฑะตะทะทะฒััะฝัะต ัะฒะตะดะพะผะปะตะฝะธั 23:00-08:00)

---

## ๐ ะัะธะผะตัั ััะตะฝะฐัะธะตะฒ

### ะกัะตะฝะฐัะธะน 1: CRITICAL ั ัะฐัััะผะธ ะฟะฐะดะตะฝะธัะผะธ ัะตะฝั

**ะะฐะฝะฝัะต:**
- ะัะดะถะตั: 20,000 โฝ

**ะกะพะฑััะธั:**
- 10:00 โ ะฝะฐะนะดะตะฝะพ 19,500 โฝ โ โ ะพัะฟัะฐะฒะปะตะฝะพ (ะฟะตัะฒะพะต)
- 12:00 โ ะฝะฐะนะดะตะฝะพ 19,400 โฝ โ โ ะพัะฟัะฐะฒะปะตะฝะพ (ัะตะฝะฐ ัะฟะฐะปะฐ)
- 14:00 โ ะฝะฐะนะดะตะฝะพ 19,600 โฝ โ โ ะะ ะพัะฟัะฐะฒะปะตะฝะพ (ัะตะฝะฐ ะฒััะพัะปะฐ, < 6ั)
- 17:00 โ ะฝะฐะนะดะตะฝะพ 19,300 โฝ โ โ ะพัะฟัะฐะฒะปะตะฝะพ (ัะตะฝะฐ ัะฟะฐะปะฐ)

### ะกัะตะฝะฐัะธะน 2: HIGH ัะฐะท ะฒ 12 ัะฐัะพะฒ

**ะะฐะฝะฝัะต:**
- ะัะดะถะตั: 50,000 โฝ
- ะััะพัะธัะตัะบะธะน ะผะธะฝะธะผัะผ: 60,000 โฝ

**ะกะพะฑััะธั:**
- ะะตะฝั 1, 10:00 โ ะฝะฐะนะดะตะฝะพ 58,000 โฝ โ โ ะพัะฟัะฐะฒะปะตะฝะพ (ะฟะตัะฒะพะต)
- ะะตะฝั 1, 14:00 โ ะฝะฐะนะดะตะฝะพ 57,500 โฝ โ โ ะะ ะพัะฟัะฐะฒะปะตะฝะพ (< 12ั)
- ะะตะฝั 1, 22:00 โ ะฝะฐะนะดะตะฝะพ 57,000 โฝ โ โ ะพัะฟัะฐะฒะปะตะฝะพ (> 12ั)
- ะะตะฝั 2, 06:00 โ ะฝะฐะนะดะตะฝะพ 56,500 โฝ โ โ ะะ ะพัะฟัะฐะฒะปะตะฝะพ (< 12ั)
- ะะตะฝั 2, 10:00 โ ะฝะฐะนะดะตะฝะพ 56,000 โฝ โ โ ะพัะฟัะฐะฒะปะตะฝะพ (> 12ั)

### ะกัะตะฝะฐัะธะน 3: LOW ะฑะตะท ัะฟะฐะผะฐ

**ะะฐะฝะฝัะต:**
- ะัะดะถะตั: 30,000 โฝ

**ะกะพะฑััะธั:**
- ะะตะฝั 1, 10:00 โ ะฝะฐะนะดะตะฝะพ 45,000 โฝ (LOW) โ โ ะพัะฟัะฐะฒะปะตะฝะพ ะะะ ะทะฒัะบะฐ (ะฟะตัะฒะพะต)
- ะะตะฝั 1, 18:00 โ ะฝะฐะนะดะตะฝะพ 44,500 โฝ (LOW) โ โ ะะ ะพัะฟัะฐะฒะปะตะฝะพ (< 24ั)
- ะะตะฝั 2, 11:00 โ ะฝะฐะนะดะตะฝะพ 44,000 โฝ (LOW) โ โ ะพัะฟัะฐะฒะปะตะฝะพ ะะะ ะทะฒัะบะฐ (> 24ั)

### ะกัะตะฝะฐัะธะน 4: ะะตัะตัะพะด ะผะตะถะดั ััะพะฒะฝัะผะธ

**ะะฐะฝะฝัะต:**
- ะัะดะถะตั: 40,000 โฝ
- ะััะพัะธัะตัะบะธะน ะผะธะฝะธะผัะผ: 50,000 โฝ

**ะกะพะฑััะธั:**
- ะะตะฝั 1, 10:00 โ ะฝะฐะนะดะตะฝะพ 55,000 โฝ (LOW) โ โ ะพัะฟัะฐะฒะปะตะฝะพ ะะะ ะทะฒัะบะฐ
- ะะตะฝั 1, 22:00 โ ะฝะฐะนะดะตะฝะพ 48,000 โฝ (HIGH) โ โ ะพัะฟัะฐะฒะปะตะฝะพ ัะพ ะทะฒัะบะพะผ (< 24ั, ะฝะพ HIGH ะดััะณะพะน ัะธะฟ)
- ะะตะฝั 2, 08:00 โ ะฝะฐะนะดะตะฝะพ 39,000 โฝ (CRITICAL) โ โ ะพัะฟัะฐะฒะปะตะฝะพ ัะพ ะทะฒัะบะพะผ (< 12ั, ะฝะพ CRITICAL ะดััะณะพะน ัะธะฟ)

---

## ๐๏ธ ะะฐัััะพะนะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั

### notifications_enabled

**ะะฝะฐัะตะฝะธั:**
- `1` โ ัะฒะตะดะพะผะปะตะฝะธั ะฒะบะปััะตะฝั (ะฟะพ ัะผะพะปัะฐะฝะธั)
- `0` โ ัะฒะตะดะพะผะปะตะฝะธั ะพัะบะปััะตะฝั

**ะะปะธัะฝะธะต:**
- ะัะปะธ `notifications_enabled = 0` โ ะฒัะต ัะฒะตะดะพะผะปะตะฝะธั ะะะ ะทะฒัะบะฐ (ะดะฐะถะต CRITICAL)
- LOW ะฒัะตะณะดะฐ ะะะ ะทะฒัะบะฐ ะฝะตะทะฐะฒะธัะธะผะพ ะพั ะฝะฐัััะพะนะบะธ

### night_mode

**ะะฝะฐัะตะฝะธั:**
- `1` โ ะฝะพัะฝะพะน ัะตะถะธะผ ะฒะบะปััะตะฝ (ะฟะพ ัะผะพะปัะฐะฝะธั)
- `0` โ ะฝะพัะฝะพะน ัะตะถะธะผ ะพัะบะปััะตะฝ

**ะะปะธัะฝะธะต:**
- ะัะปะธ `night_mode = 1` ะ ะฒัะตะผั 23:00-08:00 โ ะฒัะต ัะฒะตะดะพะผะปะตะฝะธั ะะะ ะทะฒัะบะฐ
- ะัะพะฒะตัะบะฐ ะฝะต ัะฐะฑะพัะฐะตั ะฒ ะฝะพะฒะพะน ัะธััะตะผะต, ะทะฒัะบ ะพะฟัะตะดะตะปัะตััั ะฟัะพััะพ ะฟะพ ะฒัะตะผะตะฝะธ

### timezone

**ะะฝะฐัะตะฝะธะต:** ัััะพะบะฐ ัะฐะนะผะทะพะฝั (ะฝะฐะฟัะธะผะตั, `Asia/Yekaterinburg`)

**ะะปะธัะฝะธะต:**
- ะัะฟะพะปัะทัะตััั ะดะปั ะพะฟัะตะดะตะปะตะฝะธั ะฝะพัะฝะพะณะพ ะฒัะตะผะตะฝะธ (23:00-08:00)
- ะัะฟะพะปัะทัะตััั ะดะปั ัะพัะผะฐัะธัะพะฒะฐะฝะธั ะฒัะตะผะตะฝะธ ะฒ ัะฒะตะดะพะผะปะตะฝะธัั

---

## ๐ ะะฐะถะฝัะต ะผะตัะพะดั

### NotificationService.classifyPriority(routeData)

**ะัะพะดะฝัะต ะดะฐะฝะฝัะต:**
```javascript
{
  currentPrice: number,
  userBudget: number,
  historicalMin: number
}
```

**ะะพะทะฒัะฐัะฐะตั:**
```javascript
{
  priority: 'CRITICAL' | 'HIGH' | 'LOW',
  reasons: string[]
}
```

### NotificationService._canSendNotification(chatId, routeId, priority, currentPrice)

**ะะพะทะฒัะฐัะฐะตั:**
```javascript
{
  canSend: boolean,
  reason: string
}
```

### NotificationService.processNoResults(chatId, routeId)

**ะะพะทะฒัะฐัะฐะตั:**
```javascript
{
  shouldSend: boolean,
  reason: string
}
```

### NotificationService.formatSingleRouteBlock(route, bestResult, analytics, checkStats, priority)

**ะะพะทะฒัะฐัะฐะตั:**
```javascript
{
  text: string,
  searchLink: string | null
}
```

### NotificationService._sendInstantAlert(chatId, routeId, block, priority, price, timezone, silent)

ะัะฟัะฐะฒะปัะตั ัะฒะตะดะพะผะปะตะฝะธะต ั ะฟัะฐะฒะธะปัะฝัะผ ะทะฐะณะพะปะพะฒะบะพะผ, ัััะตัะพะผ ะธ inline-ะบะฝะพะฟะบะพะน.

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

ะกะผ. `TEST_CHECKLIST.md` ะดะปั ะฟะพะปะฝะพะณะพ ัะฟะธัะบะฐ ัะตััะพะฒ.

ะัะฝะพะฒะฝัะต ะฟัะพะฒะตัะบะธ:
1. ะะปะฐััะธัะธะบะฐัะธั ะฟัะธะพัะธัะตัะพะฒ
2. ะะตัะธะพะดะธัะฝะพััั ัะฒะตะดะพะผะปะตะฝะธะน
3. ะะฟัะตะดะตะปะตะฝะธะต ะทะฒัะบะฐ
4. ะคะพัะผะฐัั ัะพะพะฑัะตะฝะธะน
5. NO_RESULTS ะพะฑัะฐะฑะพัะบะฐ

---

## ๐ ะกะผ. ัะฐะบะถะต

- `MIGRATION_SUMMARY.md` โ ัะตะทัะผะต ะผะธะณัะฐัะธะธ
- `TEST_CHECKLIST.md` โ ัะตะบ-ะปะธัั ัะตััะธัะพะฒะฐะฝะธั
- `/services/NotificationService.js` โ ัะตะฐะปะธะทะฐัะธั
- `/scheduler.js` โ ะธะฝัะตะณัะฐัะธั
